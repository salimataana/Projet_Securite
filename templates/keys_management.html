<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestion des Clés Cryptographiques</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="container py-4 keys-page">
        <div class="header">
            <h1>Gestion des Clés Cryptographiques</h1>
            <p>Surveillez vos clés RSA, contrôlez leur état et testez rapidement vos opérations critiques.</p>
            <div class="nav-links">
                <a href="/" class="nav-link nav-dark">Accueil</a>
                <a href="/operations" class="nav-link nav-primary">Opérations cryptographiques</a>
                <a href="/operations_analysis" class="nav-link nav-info">Analyse & Comparaison</a>
                </div>
        </div>

        <div class="card">
            <div class="card-header">
                <h3>Statistiques Globales</h3>
            </div>
            <div id="globalStats" class="row g-3">
                <!-- Stats loaded via JS -->
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <h3>Générer une Nouvelle Clé</h3>
            </div>
            <div class="card-body">
                <div class="row gy-3 align-items-end">
                    <div class="col-md-6">
                        <label for="keySize" class="form-label">Taille de la clé (bits)</label>
                        <select class="form-select" id="keySize">
                            <option value="2048">2048 bits (Recommandé)</option>
                            <option value="3072">3072 bits (Sécurisé)</option>
                            <option value="4096">4096 bits (Très sécurisé)</option>
                        </select>
                    </div>
                    <div class="col-md-6">
                        <button class="btn btn-success w-100" onclick="generateNewKey()" id="generateButton">
                            <i class="fas fa-key me-2"></i>Générer la Clé
                        </button>
                    </div>
                </div>
                <div id="keyGenerationResult" class="mt-3"></div>
            </div>
        </div>

        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center flex-wrap gap-3">
                <div class="d-flex align-items-center gap-3">
                    <div>
                        <h3>Clés Stockées</h3>
                        <p class="text-muted card-subtitle">Visualisez vos clés actives, leur utilisation et accédez aux actions rapides.</p>
                    </div>
                </div>
                <div class="d-flex align-items-center gap-2 flex-wrap">
                    <span class="pill" id="keysCount">0 clé</span>
                    <button class="btn ghost" onclick="loadKeys()">Actualiser</button>
                    <button class="btn" onclick="testKeyOperations()">Tester une clé</button>
                </div>
            </div>
            <div class="card-body">
                <div id="keysList">
                    <div class="empty-state">
                        <div class="loader"></div>
                        <p>Chargement des clés...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal pour les détails d'opérations -->
        <div class="modal fade" id="operationsModal" tabindex="-1">
            <div class="modal-dialog modal-xl">
                <div class="modal-content dark-modal">
                    <div class="modal-header">
                        <h5 class="modal-title">
                            <i class="fas fa-history me-2"></i>Opérations de la clé:
                            <span id="modalKeyId" class="text-primary"></span>
                        </h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <div id="operationsList"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal pour tester une clé -->
        <div class="modal fade" id="testKeyModal" tabindex="-1">
            <div class="modal-dialog modal-lg">
                <div class="modal-content dark-modal">
                    <div class="modal-header">
                        <h5 class="modal-title">Tester les opérations avec une clé</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <div class="mb-3">
                            <label class="form-label">Sélectionner une clé:</label>
                            <select class="form-select" id="testKeySelect">
                                <option value="">Chargement des clés...</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Données à tester:</label>
                            <textarea class="form-control" id="testData" rows="3">Message de test pour les opérations cryptographiques</textarea>
                        </div>
                        <div class="d-grid gap-2">
                            <button class="btn btn-primary" onclick="testSignature()">
                                <i class="fas fa-signature me-2"></i>Tester Signature
                            </button>
                            <button class="btn btn-success" onclick="testEncryption()">
                                <i class="fas fa-lock me-2"></i>Tester Chiffrement
                            </button>
                            <button class="btn btn-info" onclick="testHashAndSign()">
                                <i class="fas fa-fingerprint me-2"></i>Tester Hachage + Signature
                            </button>
                        </div>
                        <div id="testResults" class="mt-3"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/static/keys_management.js"></script>
</body>
</html>
